#!/usr/bin/env php
<?php

if (file_exists($a = getcwd() . '/vendor/autoload.php')) {
	require $a;
} elseif (file_exists($a = __DIR__ . '/../../../autoload.php')) {
	require $a;
} elseif (file_exists($a = __DIR__ . '/../vendor/autoload.php')) {
	require $a;
} else {
	fwrite(STDERR, 'Cannot locate autoloader; please run "composer install"' . PHP_EOL);
	exit(1);
}

$app = \Laminas\Mvc\Application::init(require getcwd() . '/config/application.config.php');
$config = $app->getConfig()['authentication'];

$sql = <<<EOF
create table ${config['table_name']}
(
	id       integer
        constraint ${config['table_name']}_pk
            primary key autoincrement,
    ${config['identity_column']}    varchar default 255,
    ${config['credential_column']} varchar default 255,
    status   smallint
);

create unique index ${config['table_name']}_${config['identity_column']}_uindex
    on ${config['table_name']} (${config['identity_column']});
EOF;

$app->getServiceManager()->get(\Laminas\Db\Adapter\Adapter::class)->query($sql);